openapi: 3.0.0
info:
  title: mini-kintai API
  description: 勤務管理アプリAPIドキュメント
  version: 1.0.0

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: connect.sid
      description: セッションクッキーによる認証

security:
  - cookieAuth: []

paths:
  /api/users:
    get:
      summary: ユーザー一覧の取得
      description: 全ユーザーの一覧を取得します。
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
          description: 取得するユーザー数の上限（デフォルト: 20）
      responses:
        '200':
          description: ユーザー一覧取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  list:
                    type: array
                    items:
                      type: object

  /api/users/{id}:
    get:
      summary: ユーザー詳細の取得
      description: 指定されたIDのユーザー情報を取得します。
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ユーザーID
      responses:
        '200':
          description: ユーザー取得成功
          content:
            application/json:
              schema:
                type: object
        
  /api/attendances:
    get:
      summary: 勤務管理一覧の取得
      description: ログイン済みユーザの全勤務記録の一覧を取得します。dateパラメータを指定した場合は該当日の記録のみを返します。
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
          description: 取得する勤務記録数の上限（デフォルト: 50）
        - name: date
          in: query
          schema:
            type: string
            format: date
          description: 指定した日付の勤務記録のみを取得（YYYY-MM-DD形式）
      responses:
        '200':
          description: 勤務管理一覧取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    oneOf:
                      - type: array
                        items:
                          type: object
                        description: dateパラメータなしの場合は配列
                      - type: object
                        description: dateパラメータ指定時は単一オブジェクト

  /api/attendances/{id}:
    get:
      summary: 勤務管理詳細の取得
      description: 指定されたIDの勤務記録を取得します。
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 勤務記録ID
      responses:
        '200':
          description: 勤務記録取得成功
          content:
            application/json:
              schema:
                type: object

    patch:
      summary: 勤務記録の更新
      description: 指定されたIDの勤務記録を更新します。
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 勤務記録ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                break_minutes:
                  type: integer
                  description: 休憩時間（分）
                  example: 60
                clock_in:
                  type: string
                  format: date-time
                  description: 出勤時刻（YYYY-MM-DD HH:mm:ss形式）
                  example: "2026-02-18 15:41:16"
                clock_out:
                  type: string
                  format: date-time
                  description: 退勤時刻（YYYY-MM-DD HH:mm:ss形式）
                  example: "2026-02-18 18:44:21"
            examples:
              休憩時間のみ更新:
                value:
                  break_minutes: 60
              出勤時刻を修正:
                value:
                  clock_in: "2026-02-18 09:00:00"
              退勤時刻を修正:
                value:
                  clock_out: "2026-02-18 18:30:00"
              全て更新:
                value:
                  break_minutes: 45
                  clock_in: "2026-02-18 09:00:00"
                  clock_out: "2026-02-18 18:00:00"
      responses:
        '200':
          description: 勤務記録更新成功
          content:
            application/json:
              schema:
                type: object

  /api/attendances/clock-in:
    post:
      summary: 勤務開始
      description: 勤務開始の記録を作成します。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  description: ユーザーID
              required:
                - user_id
      responses:
        '201':
          description: 勤務開始記録成功
          content:
            application/json:
              schema:
                type: object

  /api/attendances/clock-out:
    post:
      summary: 勤務終了
      description: 勤務終了の記録を作成します。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  description: ユーザーID
              required:
                - user_id
      responses:
        '201':
          description: 勤務終了記録成功
          content:
            application/json:
              schema:
                type: object

  /api/login:
    post:
      summary: ログイン
      description: メールアドレスとパスワードでログインします。セッション情報がクッキーに保存されます。
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  description: ユーザーのメールアドレス
                  example: user@example.com
                password:
                  type: string
                  description: ユーザーのパスワード
                  example: password123
              required:
                - email
                - password
      responses:
        '200':
          description: ログイン成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "ログイン成功"
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
        '401':
          description: ログイン失敗（メールアドレスまたはパスワードが不正）
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "認証失敗"

  /api/logout:
    post:
      summary: ログアウト
      description: セッション情報を破棄してログアウトします。
      responses:
        '200':
          description: ログアウト成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "ログアウトしました"

  /api/me:
    get:
      summary: 認証状態確認
      description: 現在のログイン状態とユーザー情報を取得します。
      responses:
        '200':
          description: ログイン済み
          content:
            application/json:
              schema:
                type: object
                properties:
                  loggedIn:
                    type: boolean
                    example: true
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  loggedIn:
                    type: boolean
                    example: false